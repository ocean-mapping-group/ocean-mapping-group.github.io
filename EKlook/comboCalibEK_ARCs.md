---
layout: default
title: comboCalibEK_ARCs
parent: EKlook Tools
nav_order: 2
---
# comboCalibEK_ARCs

## Description
`comboCalibEK_ARCs` is a command-line utility for post-processing Angular Response Curves (ARCs) generated by `BatchProcEK`. It offers two main functionalities:
1.  **Combining ARCs:** Merges multiple ARC files (either 3D or FFT bin-specific formats) into a single combined ARC. It can apply optional "stencilling" based on bin density, meaning it can filter out bins with low data counts.
2.  **Applying Calibration:** Applies a frequency-dependent calibration to broadband ARCs. This allows for correcting the backscatter values using external calibration data after the initial processing.
Additionally, it can generate 2D slices of the combined ARC data (either frequency slices over grazing angle or grazing angle slices over frequency).

## Usage
```bash
comboCalibEK_ARCs [OPTIONS] -out <output_prefix> -arcs <ARC_file(s)>
```

## Arguments

| Option | Description | Default / Example |
|---|---|---|
| `-v` | Enable verbose output. | |
| `-informat <format_id>` | Specifies the input ARC file format: `1` for 3D ARC (default), `2` for FFT bin-specific ARC. | `1` |
| `-outformat <format_id>` | Specifies the output ARC file format: `1` for 3D ARC (default), `2` for FFT bin-specific ARC. | `1` |
| `-bulkcalibtoremove <value>` | Specifies a bulk calibration value (in dB) to subtract from the backscatter values. | `120.0` |
| `-extradB <value>` | Additional dB value to add (or subtract if negative) to the backscatter values. | `-10.0` |
| `-minValiddB <value>` | Minimum valid dB value for backscatter. Bins below this threshold (and not NaN) are rejected. | `-100.0` |
| `-minValidGrazing <degrees>` | Minimum valid grazing angle in degrees. Bins below this are rejected. | `10.0` |
| `-HzAverage <value>` | When applying frequency calibration, averages calibration values over this frequency range (in Hz). | `5000.0` (5 kHz) |
| `-minfrac_MaxCount_toDump <fraction>` | Minimum fraction of the maximum count within an ARC bin required for that bin to be included in the output (e.g., `0.1` means dump if count > 10% of max count). | `0.0` |
| `-calib <Calibration_file.txt.r4>` | Specifies an ASCII calibration file (expected to contain frequency and gain pairs) to apply frequency-dependent corrections. | `calib_data.txt.r4` |
| `-Freq2Dslice <filename> <lowkHz> <highkHz>` | Generate a 2D frequency slice. Outputs to `<filename>`, averaging backscatter for all grazing angles between `lowkHz` and `highkHz`. | `freq_slice.txt 5.0 10.0` |
| `-Graz2Dslice <filename> <lowGraz> <highGraz>` | Generate a 2D grazing angle slice. Outputs to `<filename>`, averaging backscatter for all frequencies between `lowGraz` and `highGraz`. | `graz_slice.txt 20.0 40.0` |
| `-out <output_prefix>` | **Required.** Specifies the prefix for the output combined/calibrated ARC files. | `combined_ARCs` |
| `-arcs <ARC_file(s)>` | **Required.** One or more input ARC files (e.g., `.ARC_fullBW`, `.ARC_FFTbins`) to be combined or calibrated. Wildcards are supported. | `survey_001.ARC_FFTbin survey_002.ARC_FFTbin` |

## Output Files
*   `<output_prefix>.ARC_fullBW`: Combined full bandwidth ARC file.
*   `<output_prefix>.ARC_3D`: Combined 3D ARC file.
*   `debug.calib.sampled.txt`: Debug output for sampled calibration values (if `-calib` is used).
*   `<outFslicename>`: 2D frequency slice output (if `-Freq2Dslice` is used).
*   `<outGslicename>`: 2D grazing angle slice output (if `-Graz2Dslice` is used).