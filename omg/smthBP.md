---
layout: default
title: smthBP
parent: OMG Tools
nav_order: 65
---
# smthBP

## Description
`smthBP` is a utility designed to smooth the beam pattern output generated by `getBeamPattern` (or `newGetBP`). It applies a weighted moving average filter to the intensity and difference values of the beam pattern, helping to reduce noise and reveal underlying trends.

The smoothing is weighted by the `bcount` (number of samples in each bin), giving more influence to bins with more data.

## Usage
```bash
smthBP -in <infile> -out <outfile> [-halfwidth <value>] [-v]
```

## Arguments

| Option | Description |
|---|---|
| `-in <infile>` | **Required.** The path to the input beam pattern file (typically an ASCII file generated by `getBeamPattern` or `newGetBP`). |
| `-out <outfile>` | **Required.** The path for the smoothed output beam pattern file. |
| `-halfwidth <value>` | Specifies the half-width of the smoothing window. A `halfwidth` of `1` means a 3-point window, `2` means a 5-point window, etc. | `1` |
| `-v` | Enable verbose output. |

## How It Works
1.  **Input Reading:** Opens the input beam pattern file and reads its contents. The file is expected to have four columns: angle, intensity (`inten`), difference (`diff`), and beam count (`bcount`) for 180 angle bins.
2.  **Midsignal Calculation:** It calculates a `midsig` value, which is a weighted average of `inten` (intensity) from a specific range of angle bins (typically `25-65` and `115-155`), weighted by their `bcount`. This `midsig` serves as a reference point for normalization.
3.  **Weighted Smoothing:**
    *   For each angle bin `j` in the range `halfwidth` to `180 - halfwidth - 1`:
        *   It calculates a weighted sum of `inten` values within the smoothing window (`j - halfwidth` to `j + halfwidth`), using `bcount` as weights.
        *   The smoothed intensity (`smthinten[j]`) is the weighted average.
        *   The smoothed difference (`smthdiff[j]`) is calculated as `midsig - smthinten[j]`.
        *   The smoothed beam count (`smthbcount[j]`) is the sum of `bcount` values within the window.
    *   Bins outside this range (at the edges) are not smoothed and are typically left as `0.0`.
4.  **Output Writing:** Writes the smoothed beam pattern data (angle, `smthinten`, `smthdiff`, `smthbcount`) to the specified output file in a format similar to the input.
